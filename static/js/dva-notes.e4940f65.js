(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"./docs/dva/notes.md":function(e,n,a){"use strict";a.r(n);var t=a("./node_modules/react/index.js"),o=a.n(t),r=a("./node_modules/@mdx-js/tag/dist/index.js");function s(e,n){if(null==e)return{};var a,t,o=function(e,n){if(null==e)return{};var a,t,o={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(o[a]=e[a]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}n.default=function(e){var n=e.components;s(e,["components"]);return o.a.createElement(r.MDXTag,{name:"wrapper",components:n},o.a.createElement(r.MDXTag,{name:"h1",components:n,props:{id:"dva-\u5b66\u4e60\u7b14\u8bb0"}},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"h1",props:{"aria-hidden":!0,href:"#dva-\u5b66\u4e60\u7b14\u8bb0"}},o.a.createElement(r.MDXTag,{name:"span",components:n,parentName:"a",props:{className:"icon-link"}},"#")),"dva \u5b66\u4e60\u7b14\u8bb0"),o.a.createElement(r.MDXTag,{name:"h2",components:n,props:{id:"ant-admin-\u767b\u5f55\u9875\u662f\u5982\u4f55\u4ece\u6839\u8def\u7531\u7684\u5e03\u5c40\u5206\u79bb\u51fa\u6765"}},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"h2",props:{"aria-hidden":!0,href:"#ant-admin-\u767b\u5f55\u9875\u662f\u5982\u4f55\u4ece\u6839\u8def\u7531\u7684\u5e03\u5c40\u5206\u79bb\u51fa\u6765"}},o.a.createElement(r.MDXTag,{name:"span",components:n,parentName:"a",props:{className:"icon-link"}},"#")),"ant-admin \u767b\u5f55\u9875\u662f\u5982\u4f55\u4ece\u6839\u8def\u7531\u7684\u5e03\u5c40\u5206\u79bb\u51fa\u6765"),o.a.createElement(r.MDXTag,{name:"p",components:n},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/zuiidea/antd-admin/issues/188"}},"issues 188")),o.a.createElement(r.MDXTag,{name:"blockquote",components:n},o.a.createElement(r.MDXTag,{name:"p",components:n,parentName:"blockquote"},"\u6211\u73b0\u5728\u662f\u5728utils/config.js\u5199\u4e86\u8fd9\u4e2aopenPages: ","['/login']",",\u53ea\u8981\u5728openPages\u91cc\u7684\u9875\u9762\u90fd\u4f1a\u76f4\u63a5\u52a0\u8f7d\u800c\u4e0d\u4f1a\u52a0\u8f7d\u5e03\u5c40")),o.a.createElement(r.MDXTag,{name:"pre",components:n},o.a.createElement(r.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-js"}},"// ./src/routes/app.js\nif (config.openPages && config.openPages.indexOf(location.pathname) > -1) {\n  return <div>{children}</div>\n}\n")),o.a.createElement(r.MDXTag,{name:"pre",components:n},o.a.createElement(r.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-js"}},"// ./src/utils/config.js\nopenPages: ['/login'],\n")),o.a.createElement(r.MDXTag,{name:"h2",components:n,props:{id:"\u5982\u4f55-abort-\u8bf7\u6c42"}},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"h2",props:{"aria-hidden":!0,href:"#\u5982\u4f55-abort-\u8bf7\u6c42"}},o.a.createElement(r.MDXTag,{name:"span",components:n,parentName:"a",props:{className:"icon-link"}},"#")),"\u5982\u4f55 abort \u8bf7\u6c42"),o.a.createElement(r.MDXTag,{name:"p",components:n},"\u53ef\u80fd\u8981\u901a\u8fc7 take \u6216\u8005 takeEvery \u6765\u5b9e\u73b0\uff0c\u6682\u65f6\u4e0d\u6295\u5165\u786e\u8ba4\u3002"),o.a.createElement(r.MDXTag,{name:"h2",components:n,props:{id:"model-\u4e2d\u5b9a\u65f6\u8f6e\u8be2\u7684\u5b9e\u73b0\u4e0e\u95ee\u9898"}},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"h2",props:{"aria-hidden":!0,href:"#model-\u4e2d\u5b9a\u65f6\u8f6e\u8be2\u7684\u5b9e\u73b0\u4e0e\u95ee\u9898"}},o.a.createElement(r.MDXTag,{name:"span",components:n,parentName:"a",props:{className:"icon-link"}},"#")),"model \u4e2d\u5b9a\u65f6\u8f6e\u8be2\u7684\u5b9e\u73b0\u4e0e\u95ee\u9898"),o.a.createElement(r.MDXTag,{name:"p",components:n},"\u76ee\u524d\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u5355\u72ec\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7ba1\u7406\u72b6\u6001\u7684\u7ec4\u5efa\uff0c\u63a5\u53d7\u76f8\u5173\u53c2\u6570\u8fdb\u884c\u8f6e\u5bfb\u3002"),o.a.createElement(r.MDXTag,{name:"h3",components:n,props:{id:"\u66f4\u65b0\uff1a"}},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"h3",props:{"aria-hidden":!0,href:"#\u66f4\u65b0\uff1a"}},o.a.createElement(r.MDXTag,{name:"span",components:n,parentName:"a",props:{className:"icon-link"}},"#")),"\u66f4\u65b0\uff1a"),o.a.createElement(r.MDXTag,{name:"p",components:n},"\u901a\u8fc7 saga \u7684 fork \u63a5\u53e3\u521b\u5efa\u4e00\u4e2a\u5b50\u4efb\u52a1\uff0c\u5b50\u4efb\u52a1\u4e2d\u8fdb\u884c for \u5faa\u73af\uff0c\u540c\u65f6\u76d1\u542c\u9500\u6bc1\u8d44\u6e90\u7684 effects\uff0c\u8d44\u6e90\u9500\u6bc1\u65f6\u5c06 fork \u7684\u5b50\u4efb\u52a1\u53d6\u6d88\u6389\u3002"),o.a.createElement(r.MDXTag,{name:"p",components:n},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"http://leonshi.com/redux-saga-in-chinese/docs/advanced/NonBlockingCalls.html"}},"\u53c2\u8003\u8d44\u6599")),o.a.createElement(r.MDXTag,{name:"p",components:n},"\u793a\u4f8b\u4ee3\u7801\uff1a"),o.a.createElement(r.MDXTag,{name:"pre",components:n},o.a.createElement(r.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-js"}},"// model.js\n// ...\nimport { service } from '../services';\n\nfunction* keepalive({ call, put }) {\n  while (true) {\n    // do something ...\n    yield call(delay, 1000 * 20);\n  }\n}\n\nexport default {\n\n  namespace: 'namespace',\n\n  state: {\n    data: null,\n    // state ...\n  },\n\n  subscriptions: {\n    // subscriptions ...\n  },\n\n  effects: {\n    *loginSucceed({ payload }, { put, fork, take, cancel, call }) {\n      const task = yield fork(keepalive, { put, call });\n      yield take(['logout', 'loginFaild']);\n      yield cancel(task);\n    },\n    *loginFaild({ payload }, { }) {\n      // do something ...\n    },\n    *logout({ payload }, { }) {\n      // do something ...\n    },\n  },\n\n  reducers: {\n    setData(state, action) {\n      return { ...state, data: action.payload };\n    },\n  },\n};\n")),o.a.createElement(r.MDXTag,{name:"h2",components:n,props:{id:"\u591a\u4e2a\u5f02\u6b65-effects-\u65f6\u5e8f\u63a7\u5236\u95ee\u9898"}},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"h2",props:{"aria-hidden":!0,href:"#\u591a\u4e2a\u5f02\u6b65-effects-\u65f6\u5e8f\u63a7\u5236\u95ee\u9898"}},o.a.createElement(r.MDXTag,{name:"span",components:n,parentName:"a",props:{className:"icon-link"}},"#")),"\u591a\u4e2a\u5f02\u6b65 effects \u65f6\u5e8f\u63a7\u5236\u95ee\u9898"),o.a.createElement(r.MDXTag,{name:"p",components:n},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/dvajs/dva/issues/248"}},"Issues 248")),o.a.createElement(r.MDXTag,{name:"blockquote",components:n},o.a.createElement(r.MDXTag,{name:"p",components:n,parentName:"blockquote"},"\u4e24\u4e2a\u65b9\u6848\uff1a"),o.a.createElement(r.MDXTag,{name:"p",components:n,parentName:"blockquote"},"\u901a\u8fc7 put action \u53bb\u8c03? yield put({ type: 'auth' });\uff0c\u7f3a\u70b9\u662f\u4e0d\u4f1a\u7b49\u5f85\u5b8c\u6210"),o.a.createElement(r.MDXTag,{name:"p",components:n,parentName:"blockquote"},"auth \u62bd\u5230 model \u5916\uff0c\u7136\u540e\u5728 effect \u91cc\u7528 yiled * \u53bb\u8c03\u4ed6")),o.a.createElement(r.MDXTag,{name:"pre",components:n},o.a.createElement(r.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-js"}},"// model.js\n// ...\nimport { service } from '../services';\nfunction* doSomeThing({ call, put, select }){\n  // \u7b49\u5f85 doAnotherThing \u5b8c\u6210\u540e\u7ee7\u7eed\u5904\u7406\n  yield* doAnotherThing({ call, put, select });\n  // \u4e00\u4e9b\u5f02\u6b65\u90e8\u64cd\u4f5c\n  const data = yield call(service.start);\n  yield put({ type: 'setData', payload: data });\n}\nfunction* doAnotherThing({ call, put, select }){\n  const { params } = yield select(state => state.namespace);\n  const data = yield call(service.stop, params);\n  yield put({ type: 'setData', payload: null });\n}\n\nexport default {\n\n  namespace: 'namespace',\n\n  state: {\n    data: null,\n    // state ...\n  },\n\n  subscriptions: {\n    // subscriptions ...\n  },\n\n  effects: {\n    *doSomeThing({ payload }, { call, put, select }){\n      yield call(doSomeThing, { call, put, select });\n    },\n  },\n\n  reducers: {\n    setData(state, action) {\n      return { ...state, data: action.payload };\n    },\n  },\n};\n")),o.a.createElement(r.MDXTag,{name:"p",components:n},"dva@2.0 \u53d1\u5e03\u4ee5\u540e\uff0cdispatch \u8fd4\u56de Proimse\uff0c\u53ef\u4ee5\u901a\u8fc7\u53d1\u8d77\u591a\u4e2a action \u7684\u65b9\u5f0f\u8fdb\u884c\u63a7\u5236\u4e86"),o.a.createElement(r.MDXTag,{name:"p",components:n},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/sorrycc/blog/issues/48"}},"dva 2.0 \u53d1\u5e03")),o.a.createElement(r.MDXTag,{name:"blockquote",components:n},o.a.createElement(r.MDXTag,{name:"p",components:n,parentName:"blockquote"},"dispatch(effectAction) => Proimse"),o.a.createElement(r.MDXTag,{name:"p",components:n,parentName:"blockquote"},"\u4e3a\u4e86\u65b9\u4fbf\u5728\u89c6\u56fe\u5c42 dispatch action \u5e76\u5904\u7406\u56de\u8c03\uff0c\u6bd4\u5982 #175\uff0c\u6211\u4eec\u5728 dispatch \u91cc\u9488\u5bf9 effect \u7c7b\u578b\u7684 action \u505a\u4e86\u8fd4\u56de Promise \u7684\u7279\u6b8a\u5904\u7406\u3002")),o.a.createElement(r.MDXTag,{name:"h2",components:n,props:{id:"jwt-\u7ba1\u7406\u5b9e\u73b0"}},o.a.createElement(r.MDXTag,{name:"a",components:n,parentName:"h2",props:{"aria-hidden":!0,href:"#jwt-\u7ba1\u7406\u5b9e\u73b0"}},o.a.createElement(r.MDXTag,{name:"span",components:n,parentName:"a",props:{className:"icon-link"}},"#")),"jwt \u7ba1\u7406\u5b9e\u73b0"),o.a.createElement(r.MDXTag,{name:"pre",components:n},o.a.createElement(r.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-js"}},"// src/model/app.js\nimport { auth, delay } from '../utils';\n\nconst aliveInterval = 10 * 60 * 1000;\nfunction* keepalive({ call, put }) {\n  while (true) {\n    // \u5224\u65ad jwt \u662f\u5426\u9700\u8981\u66f4\u65b0\n    const timeLeft = auth.getJwtTimeLeft();\n    if (timeLeft < aliveInterval) {\n      const res = yield call(updateJwt, { call, put });\n      if (false === res) {\n        // jwt \u66f4\u65b0\u5931\u8d25\n        return yield put({ type: 'loginFaild' });\n      }\n    }\n    yield call(delay, aliveInterval);\n  }\n}\n\nconst updateJwt = async () => {\n  // \u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff0c\u7528\u4e8e\u66f4\u65b0jwt\n  const userInfo = getUserInfo();\n  const expired = auth.getUserLoginExpired();\n  // \u53d1\u9001 request \u66f4\u65b0jwt\n  const response = await user.userLogin({ username: userInfo.username, password: userInfo.password, expired });\n  if (response.data) {\n    // \u7f13\u5b58jwt\n    saveJwt();\n    return true;\n  }\n  if (response.err) {\n    return false;\n  }\n};\n\nexport default {\n  namespace: 'app',\n  state:  { /* ... */ },\n  subscriptions: { /* ... */ },\n  effects: {\n    // ...\n    *loginSucceed({ payload }, { put, fork, take, cancel, call }) {\n      const task = yield fork(keepalive, { put, call });\n      auth.setUpdateJwtHandle(updateJwt);\n      yield take(['logout', 'loginFaild']);\n      auth.setUpdateJwtHandle(null);\n      yield cancel(task);\n    },\n  },\n  reducers: { /* ... */ },\n};\n")),o.a.createElement(r.MDXTag,{name:"pre",components:n},o.a.createElement(r.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-js"}},"// src/utils/auth.js\nlet updateJwtHandle = null;\nconst setUpdateJwtHandle = (handle) => {\n  updateJwtHandle = handle;\n};\n\nconst getEffectiveJwt = () => {\n  // debugger;\n  return new Promise((resolve, reject) => {\n    const error = new Error('Unauthorized');\n    error.response = { status: 401 };\n    const jwt = getJwt();\n    if (jwt) {\n      return resolve(jwt);\n    } else if (!updateJwtHandle) {\n      return reject(error);\n    }\n    // debugger;\n    updateJwtHandle().then(() => {\n      return resolve(getJwt());\n    }).catch(() => {\n      return reject(error);\n    });\n  });\n};\n\nexport default {\n  getEffectiveJwt,\n};\n")),o.a.createElement(r.MDXTag,{name:"pre",components:n},o.a.createElement(r.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-js"}},"// src/utils/request.js\nimport fetch from 'dva/fetch';\nimport { getEffectiveJwt } from './auth';\n\nfunction request(resource, opts) {\n  // debugger;\n  return getEffectiveJwt().then((jwt) => {\n    return ajax(resource, opts, jwt);\n  }).catch(err => ({ err }));\n}\n\nfunction requestNotNecessaryJwt(resource, opts) {\n  return getEffectiveJwt().then((jwt) => {\n    return ajax(resource, opts, jwt);\n  }).catch(() => {\n    return ajax(resource, opts);\n  });\n}\n\nfunction requestWithoutJwt(resource, opts) {\n  return ajax(resource, opts);\n}\n\nfunction ajax(resource, opts, jwt) {\n  const headers = {\n    'Content-Type': 'application/json',\n  };\n  if (jwt) {\n    headers.Authorization = `Bearer ${jwt}`;\n  }\n  const options = Object.assign({}, {\n    method: 'GET',\n    mode: 'cors',\n    headers,\n  }, opts);\n\n  return fetch(resource, options)\n    .then(checkStatus)\n    .then(parseText)\n    .then(parseJSON)\n    .then(data => ({ data }))\n    .catch(err => ({ err }));\n}\n\nexport default {\n  request,\n  requestNotNecessaryJwt,\n  requestWithoutJwt,\n};\n")))}}}]);